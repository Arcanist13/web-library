<mat-card>
  <mat-card-content>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Title -->
      <h2>{{ getHeaderText() }}</h2>
      <mat-error *ngIf="formInvalid" class="mb-2">
        There is an error within the form.
      </mat-error>

      <!-- Admin options -->
      <div *ngIf="loggedIn && !editing">
        <button mat-fab class="book-button" color="general" (click)="editBook()" matTooltip="Edit"
          aria-label="Button that switches to edit book mode">
          <mat-icon>edit_note</mat-icon>
        </button>
        <button mat-fab class="book-button" color="danger" (click)="confirmDelete()"
          matTooltip="Delete" aria-label="Button that deletes the book" aria-label="Delete book button">
          <mat-icon>delete_forever</mat-icon>
        </button>
      </div>

      <!-- Form fields -->
      <mat-form-field *ngFor="let key of getFormKeys()" class="full-width-input mb-2">
        <mat-label>{{ key | niceKeyString | titlecase }}</mat-label>
        <input matInput [formControlName]="key" [ngClass]="{'full-text': !editing}" [matAutocomplete]="auto"
          [matAutocompleteDisabled]="!isAutocomplete(key)">
        <mat-error *ngIf="getField(key)?.hasError('required')">The book {{ key }} is required</mat-error>
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
          <mat-option *ngFor="let option of getAutocomplete(key) | async" [value]="option">
            {{option}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <div>
        <button type="button" *ngIf="editing" mat-raised-button color="basic" (click)="close()"
          class="me-2">Cancel</button>
        <button *ngIf="editing" mat-raised-button color="general" type="submit">{{ getSubmitText() }}</button>
      </div>

      <div class="mt-3">
        <div class="fit-content d-flex align-items-center justify-content-center" *ngIf="(!!data?.image_full)">
          <img [src]="'data:image/jpg;base64,'+data?.image_full" class="img-fluid rounded" alt="Book cover image">

          <!-- Edit existing image -->
          <label *ngIf="editing" for="file-upload" class="float-button">
            <a mat-mini-fab color="general" aria-label="Button to change the book cover image">
              <mat-icon>edit</mat-icon>
            </a>
          </label>
          <input *ngIf="editing" class="d-none" id="file-upload" type="file" accept="image/*" capture="environment" (change)="fileUpload($any($event.target).files[0])">
        </div>
      </div>
      <!-- Upload initial image -->
      <div class="mt-3" *ngIf="editing && (!data?.image_full)">
        <ngx-dropzone (change)="fileUpload($event.addedFiles[0])" [multiple]="false" type="file" accept="image/*">
          <ngx-dropzone-label>No cover image, add new.</ngx-dropzone-label>
        </ngx-dropzone>
      </div>
    </form>
  </mat-card-content>
</mat-card>
